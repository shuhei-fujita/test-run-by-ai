# Gherkin 記法ルール（一次情報）

本プロジェクトのテストシナリオは Gherkin 形式の Markdown（`.md`）で記述する。

## キーワード一覧

| キーワード | 用途 | 記述言語 |
|---|---|---|
| `Feature:` | テスト対象の機能名 | 日本語 |
| `Scenario:` | 個別のテストシナリオ | 日本語 |
| `Scenario Outline:` | パラメータ化シナリオ（Examples と組み合わせ） | 日本語 |
| `Given` | 前提条件 | 文は日本語、キーワードは英語 |
| `When` | 操作・アクション | 同上 |
| `Then` | 期待結果 | 同上 |
| `And` | 直前のキーワードの追加条件 | 同上 |
| `Examples:` | Scenario Outline のパラメータテーブル | - |

## インデント規則

```
Feature: {機能名}          ← インデントなし
                           ← 空行
  {説明文}                 ← 2スペース
                           ← 空行
  @TC-X-Y @P0             ← 2スペース（タグ行）
  Scenario: {シナリオ名}   ← 2スペース
    Given {前提条件}       ← 4スペース
    When {操作}            ← 4スペース
    Then {期待結果}        ← 4スペース
    And {追加条件}         ← 4スペース
```

- タブは使用禁止。スペースのみ
- `Feature:` と `Scenario:` の間、各 Scenario の間には空行を入れる

## タグ

### テストID: `@TC-X-Y`

- `X`: カテゴリ番号、`Y`: カテゴリ内の連番
- Scenario の直前行に配置する
- **IDは必ずシナリオ名とセットで表記する**（ID単独での使用禁止）
- IDはgrepで横串検索するためのポインタ。意味はシナリオ名が担う

### 優先度: `@P0` / `@P1` / `@P2`

| タグ | 意味 | 基準 |
|---|---|---|
| `@P0` | 最優先 | 業務影響あり。認証・データ保全・エラーハンドリング等 |
| `@P1` | 重要 | ユーザー影響あり。状態遷移・主要機能・境界値等 |
| `@P2` | 低優先 | ユーザー影響なし。UI/表示・レスポンシブ等 |

タグはスペース区切りで Scenario 直前行にまとめる：

```
  @TC-1-1 @P0
  Scenario: トップページから動画を検索する
```

## カテゴリ区切り（コメントブロック）

シナリオ数が多い場合、機能カテゴリをコメントブロックで区切る：

```
  # ============================================================
  # {カテゴリ名}
  # ============================================================
```

## Scenario Outline（パラメータ化テスト）

同じ構造で入力値だけ異なるテストは `Scenario Outline` + `Examples` を使う：

```gherkin
  Scenario Outline: ステータスに応じた編集可否
    Given 月次ステータスが<ステータス>である
    When 日付行の状態を確認する
    Then 日付行のクリック可否が<クリック可否>である

    Examples:
      | ステータス | クリック可否 |
      | draft      | クリック可能 |
      | pending    | クリック不可 |
      | approved   | クリック不可 |
```

- パラメータは `<パラメータ名>` で参照する
- `Examples:` は 4スペースインデント（Scenario 内）
- テーブルは 6スペースインデント

## ファイル形式

### 形式1: シンプル形式（推奨）

playwright-cli で直接実行するテストスイート用。ファイル先頭にメタデータなし。

```markdown
Feature: YouTube動画検索

  YouTubeで検索機能が正しく動作することを確認する

  @TC-1-1 @P0
  Scenario: トップページから動画を検索する
    Given ブラウザで "https://www.youtube.com/" を開く
    When 検索ボックスに "Playwright tutorial" と入力する
    And Enterキーを押して検索を実行する
    Then 検索結果ページに遷移する
    And 動画のサムネイルが一覧表示される
    And スクリーンショットを撮影する
```

テストIDがないシナリオ（1件だけ等）はタグ行を省略してよい：

```markdown
  Scenario: ドキュメントサイトで "locator" を検索する
    Given ブラウザで "https://playwright.dev" を開く
    ...
```

### 形式2: 詳細形式

テストケース管理ドキュメント用。各シナリオにメタデータテーブルを付与する。

```markdown
URL: /attendance

# テストケース: マイ勤怠記録画面

## 基本情報
- **対象テスト観点**: `docs/test-perspective/テスト観点_マイ勤怠記録.md`
- **作成日**: 2026-02-10

---

## 🔴 P0（業務影響あり）

### 1. 権限・データスコープ

#### TC-1-1: 未ログインアクセス

| 項目     | 内容           |
| -------- | -------------- |
| 観点No   | 1-1            |
| 優先度   | 🔴 P0           |
| 前提条件 | 未ログイン状態 |

```gherkin
Feature: マイ勤怠記録 - 権限チェック

  Scenario: 未認証ユーザーのアクセス拒否
    Given ユーザーが未ログイン状態である
    When /attendance/my-records にアクセスする
    Then ログイン画面にリダイレクトされる
```
```

詳細形式の構造ルール：

- 先頭行に `URL: {パス}` でテスト対象URLを記載
- 優先度ごとにセクションを分ける（`## 🔴 P0` → `## 🟡 P1` → `## 🟢 P2`）
- 各テストケースは `#### TC-X-Y: {シナリオ名}` の見出し + メタデータテーブル + gherkin コードブロック
- Gherkin 部分は ` ```gherkin ` のフェンスドコードブロック内に記述
- エラーハンドリングが重要な画面では「エラーハンドリング分岐マップ」セクションを冒頭に配置

## 文体ルール

- `Given` / `When` / `Then` に続く文は **「〜する」「〜である」** の常体（だ/である調）で統一
- 具体的な値はダブルクォートで囲む：`"Playwright tutorial"`
- UI要素名は鉤括弧で囲む：`「月次を締める」ボタン`
- URL・パスはそのまま記述：`/attendance/my-records`
- 環境変数は `$変数名` で参照：`"$BASE_URL/login"`

## 配置先

- `test-suites/{案件名}/test_suite.md`
- 1つの Feature につき 1ファイルが基本（シナリオが多い場合は分割可）
